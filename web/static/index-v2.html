<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cloud Deploy - Multi-Cloud Manifest Generator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background-color: #f5f5f5;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        h1 {
            color: #333;
            margin-bottom: 10px;
        }

        .subtitle {
            color: #666;
            margin-bottom: 30px;
        }

        .form-section {
            margin-bottom: 30px;
            padding: 20px;
            background-color: #f9f9f9;
            border-radius: 5px;
        }

        .form-section h2 {
            color: #444;
            margin-bottom: 15px;
            font-size: 18px;
            border-bottom: 2px solid #ddd;
            padding-bottom: 5px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            color: #555;
            font-weight: bold;
        }

        .required {
            color: red;
        }

        input[type="text"],
        input[type="number"],
        select,
        textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }

        input[type="checkbox"] {
            margin-right: 5px;
        }

        .checkbox-label {
            display: inline;
            font-weight: normal;
        }

        .help-text {
            font-size: 12px;
            color: #777;
            margin-top: 3px;
        }

        .hidden {
            display: none;
        }

        .button-group {
            margin-top: 30px;
            display: flex;
            gap: 10px;
        }

        button {
            padding: 12px 30px;
            font-size: 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
        }

        .btn-primary {
            background-color: #007bff;
            color: white;
        }

        .btn-primary:hover {
            background-color: #0056b3;
        }

        .btn-secondary {
            background-color: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background-color: #545b62;
        }

        .message {
            padding: 15px;
            margin-top: 20px;
            border-radius: 4px;
        }

        .success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .provider-checkbox-group {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .provider-checkbox {
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .provider-checkbox:hover {
            border-color: #007bff;
            background-color: #f8f9fa;
        }

        .provider-checkbox input:checked + label {
            color: #007bff;
            font-weight: bold;
        }

        .two-column {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        @media (max-width: 600px) {
            .two-column, .provider-checkbox-group {
                grid-template-columns: 1fr;
            }
        }

        .provider-config {
            border-left: 4px solid #007bff;
            padding-left: 15px;
            margin-bottom: 20px;
        }

        .cloudflare-section {
            background: linear-gradient(135deg, #f38020 0%, #ff6b35 100%);
            color: white;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
        }

        .cloudflare-section h2 {
            color: white;
            border-bottom-color: rgba(255,255,255,0.3);
        }

        .cloudflare-section input,
        .cloudflare-section select,
        .cloudflare-section textarea {
            background: rgba(255,255,255,0.9);
        }

        .pool-item {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Cloud Deploy - Multi-Cloud Manifest Generator</h1>
        <p class="subtitle">Deploy to AWS, GCP, and Azure simultaneously with automatic Cloudflare Load Balancing</p>

        <form id="manifestForm">
            <!-- Provider Selection -->
            <div class="form-section">
                <h2>Cloud Providers</h2>
                <p class="help-text" style="margin-bottom: 15px;">Select one or more cloud providers to deploy to</p>
                <div class="provider-checkbox-group">
                    <div class="provider-checkbox">
                        <input type="checkbox" id="provider-aws" value="aws">
                        <label for="provider-aws" class="checkbox-label">AWS (Elastic Beanstalk)</label>
                    </div>
                    <div class="provider-checkbox">
                        <input type="checkbox" id="provider-gcp" value="gcp">
                        <label for="provider-gcp" class="checkbox-label">GCP (Cloud Run)</label>
                    </div>
                    <div class="provider-checkbox">
                        <input type="checkbox" id="provider-azure" value="azure">
                        <label for="provider-azure" class="checkbox-label">Azure (Container Instances)</label>
                    </div>
                </div>
            </div>

            <!-- Credentials Configuration -->
            <div class="form-section">
                <h2>Credentials Management</h2>
                <div class="form-group">
                    <label for="credentialsSource">Credentials Source <span class="required">*</span></label>
                    <select id="credentialsSource" required>
                        <option value="environment">Environment Variables</option>
                        <option value="secrets-manager" selected>AWS Secrets Manager</option>
                        <option value="vault">HashiCorp Vault</option>
                        <option value="encrypted-file">Encrypted File</option>
                    </select>
                    <div class="help-text">Recommended: AWS Secrets Manager for production</div>
                </div>

                <!-- Secrets Manager Configuration -->
                <div id="secretsManagerConfig" class="hidden">
                    <div class="form-group">
                        <label for="awsSecretArn">AWS Credentials Secret ARN</label>
                        <input type="text" id="awsSecretArn" placeholder="arn:aws:secretsmanager:region:account:secret:cloud-deploy/aws">
                    </div>
                    <div class="form-group">
                        <label for="gcpSecretArn">GCP Credentials Secret ARN</label>
                        <input type="text" id="gcpSecretArn" placeholder="arn:aws:secretsmanager:region:account:secret:cloud-deploy/gcp">
                    </div>
                    <div class="form-group">
                        <label for="azureSecretArn">Azure Credentials Secret ARN</label>
                        <input type="text" id="azureSecretArn" placeholder="arn:aws:secretsmanager:region:account:secret:cloud-deploy/azure">
                    </div>
                    <div class="form-group">
                        <label for="cloudflareSecretArn">Cloudflare Credentials Secret ARN</label>
                        <input type="text" id="cloudflareSecretArn" placeholder="arn:aws:secretsmanager:region:account:secret:cloud-deploy/cloudflare">
                    </div>
                </div>
            </div>

            <!-- Common Fields -->
            <div id="commonFields" class="hidden">
                <!-- Application Section -->
                <div class="form-section">
                    <h2>Application</h2>
                    <div class="form-group">
                        <label for="appName">Application Name <span class="required">*</span></label>
                        <input type="text" id="appName" required>
                        <div class="help-text">Unique name for your application</div>
                    </div>
                    <div class="form-group">
                        <label for="appDescription">Description</label>
                        <input type="text" id="appDescription">
                    </div>
                </div>

                <!-- Environment Section -->
                <div class="form-section">
                    <h2>Environment</h2>
                    <div class="form-group">
                        <label for="envName">Environment Name <span class="required">*</span></label>
                        <input type="text" id="envName" required>
                        <div class="help-text">Name for this deployment environment (e.g., production, staging)</div>
                    </div>
                </div>

                <!-- Deployment Section -->
                <div class="form-section">
                    <h2>Deployment</h2>
                    <div class="form-group">
                        <label for="platform">Platform</label>
                        <select id="platform">
                            <option value="docker">Docker</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="sourceType">Source Type <span class="required">*</span></label>
                        <select id="sourceType" required>
                            <option value="local">Local Directory</option>
                            <option value="s3">S3 Bucket</option>
                            <option value="git">Git Repository</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="sourcePath">Source Path <span class="required">*</span></label>
                        <input type="text" id="sourcePath" value="." required>
                    </div>
                </div>
            </div>

            <!-- AWS Configuration -->
            <div id="awsConfig" class="hidden">
                <div class="form-section provider-config">
                    <h2>AWS Configuration</h2>
                    <div class="two-column">
                        <div class="form-group">
                            <label for="awsRegion">Region <span class="required">*</span></label>
                            <select id="awsRegion" required>
                                <option value="">-- Select region --</option>
                                <option value="us-east-1">us-east-1 (N. Virginia)</option>
                                <option value="us-east-2">us-east-2 (Ohio)</option>
                                <option value="us-west-1">us-west-1 (N. California)</option>
                                <option value="us-west-2">us-west-2 (Oregon)</option>
                                <option value="eu-west-1">eu-west-1 (Ireland)</option>
                                <option value="eu-central-1">eu-central-1 (Frankfurt)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="instanceType">Instance Type</label>
                            <select id="instanceType">
                                <option value="t3.micro" selected>t3.micro</option>
                                <option value="t3.small">t3.small</option>
                                <option value="t3.medium">t3.medium</option>
                                <option value="t3.large">t3.large</option>
                            </select>
                        </div>
                    </div>
                    <div class="two-column">
                        <div class="form-group">
                            <label for="environmentType">Environment Type</label>
                            <select id="environmentType">
                                <option value="SingleInstance" selected>Single Instance</option>
                                <option value="LoadBalanced">Load Balanced</option>
                            </select>
                            <div class="help-text">Single Instance is more cost-effective for testing</div>
                        </div>
                        <div class="form-group">
                            <label for="healthCheckPath">Health Check Path</label>
                            <input type="text" id="healthCheckPath" placeholder="/health" value="/health">
                        </div>
                    </div>
                </div>
            </div>

            <!-- GCP Configuration -->
            <div id="gcpConfig" class="hidden">
                <div class="form-section provider-config">
                    <h2>GCP Configuration</h2>
                    <div class="two-column">
                        <div class="form-group">
                            <label for="gcpRegion">Region <span class="required">*</span></label>
                            <select id="gcpRegion" required>
                                <option value="">-- Select region --</option>
                                <option value="us-central1">us-central1 (Iowa)</option>
                                <option value="us-east1">us-east1 (South Carolina)</option>
                                <option value="us-west1">us-west1 (Oregon)</option>
                                <option value="europe-west1">europe-west1 (Belgium)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="projectId">Project ID <span class="required">*</span></label>
                            <input type="text" id="projectId" required>
                        </div>
                    </div>
                    <div class="two-column">
                        <div class="form-group">
                            <label for="cpu">CPU</label>
                            <select id="cpu">
                                <option value="1" selected>1</option>
                                <option value="2">2</option>
                                <option value="4">4</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="memory">Memory</label>
                            <select id="memory">
                                <option value="512Mi" selected>512Mi</option>
                                <option value="1Gi">1Gi</option>
                                <option value="2Gi">2Gi</option>
                                <option value="4Gi">4Gi</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Azure Configuration -->
            <div id="azureConfig" class="hidden">
                <div class="form-section provider-config">
                    <h2>Azure Configuration</h2>
                    <div class="two-column">
                        <div class="form-group">
                            <label for="azureRegion">Region <span class="required">*</span></label>
                            <select id="azureRegion" required>
                                <option value="">-- Select region --</option>
                                <option value="eastus">East US</option>
                                <option value="westus">West US</option>
                                <option value="centralus">Central US</option>
                                <option value="northeurope">North Europe</option>
                                <option value="westeurope">West Europe</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="resourceGroup">Resource Group <span class="required">*</span></label>
                            <input type="text" id="resourceGroup" required>
                        </div>
                    </div>
                    <div class="two-column">
                        <div class="form-group">
                            <label for="azureCpu">CPU Cores</label>
                            <input type="number" id="azureCpu" value="1.0" step="0.1" min="0.1">
                            <div class="help-text">Default: 1.0 core</div>
                        </div>
                        <div class="form-group">
                            <label for="azureMemory">Memory (GB)</label>
                            <input type="number" id="azureMemory" value="1.5" step="0.1" min="0.1">
                            <div class="help-text">Default: 1.5 GB</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Cloudflare Configuration -->
            <div id="cloudflareConfig" class="hidden">
                <div class="form-section cloudflare-section">
                    <h2>☁️ Cloudflare Load Balancing</h2>
                    <div class="form-group">
                        <input type="checkbox" id="cloudflareEnabled">
                        <label for="cloudflareEnabled" class="checkbox-label">Enable Cloudflare Load Balancing</label>
                        <div class="help-text">Automatically configure load balancing across all selected providers</div>
                    </div>

                    <div id="cloudflareFields" class="hidden">
                        <div class="two-column">
                            <div class="form-group">
                                <label for="cloudflareZoneId">Zone ID <span class="required">*</span></label>
                                <input type="text" id="cloudflareZoneId" required>
                            </div>
                            <div class="form-group">
                                <label for="cloudflareDomain">Domain <span class="required">*</span></label>
                                <input type="text" id="cloudflareDomain" placeholder="myapp.example.com" required>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="lbName">Load Balancer Name <span class="required">*</span></label>
                            <input type="text" id="lbName" required>
                        </div>

                        <div class="two-column">
                            <div class="form-group">
                                <label for="steeringPolicy">Steering Policy</label>
                                <select id="steeringPolicy">
                                    <option value="random">Random</option>
                                    <option value="geo">Geographic</option>
                                    <option value="dynamic_latency">Dynamic Latency</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="proxied">Proxied</label>
                                <input type="checkbox" id="proxied" checked>
                                <label for="proxied" class="checkbox-label">Enable Cloudflare Proxy</label>
                            </div>
                        </div>

                        <div class="form-group">
                            <label>Health Monitor</label>
                            <div class="pool-item">
                                <div class="two-column">
                                    <div class="form-group">
                                        <label for="monitorType">Type</label>
                                        <select id="monitorType">
                                            <option value="http">HTTP</option>
                                            <option value="https">HTTPS</option>
                                            <option value="tcp">TCP</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="monitorPath">Path</label>
                                        <input type="text" id="monitorPath" placeholder="/health">
                                    </div>
                                </div>
                                <div class="two-column">
                                    <div class="form-group">
                                        <label for="monitorInterval">Interval (seconds)</label>
                                        <input type="number" id="monitorInterval" value="60" min="10">
                                    </div>
                                    <div class="form-group">
                                        <label for="monitorRetries">Retries</label>
                                        <input type="number" id="monitorRetries" value="2" min="1">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Submit Buttons -->
            <div class="button-group">
                <button type="submit" class="btn-primary">Generate Manifest</button>
                <button type="reset" class="btn-secondary">Reset Form</button>
            </div>
        </form>

        <!-- Message Area -->
        <div id="messageArea"></div>
    </div>

    <script>
        // Provider selection handler
        const providerCheckboxes = document.querySelectorAll('input[id^="provider-"]');
        providerCheckboxes.forEach(checkbox => {
            checkbox.addEventListener('change', updateProviderSections);
        });

        function updateProviderSections() {
            const awsChecked = document.getElementById('provider-aws').checked;
            const gcpChecked = document.getElementById('provider-gcp').checked;
            const azureChecked = document.getElementById('provider-azure').checked;
            const anySelected = awsChecked || gcpChecked || azureChecked;

            // Show/hide common fields
            document.getElementById('commonFields').classList.toggle('hidden', !anySelected);

            // Show/hide provider-specific sections
            document.getElementById('awsConfig').classList.toggle('hidden', !awsChecked);
            document.getElementById('gcpConfig').classList.toggle('hidden', !gcpChecked);
            document.getElementById('azureConfig').classList.toggle('hidden', !azureChecked);

            // Show Cloudflare section if multiple providers selected
            const multiProvider = [awsChecked, gcpChecked, azureChecked].filter(Boolean).length > 1;
            document.getElementById('cloudflareConfig').classList.toggle('hidden', !multiProvider);
        }

        // Credentials source handler
        document.getElementById('credentialsSource').addEventListener('change', function() {
            const secretsManagerConfig = document.getElementById('secretsManagerConfig');
            secretsManagerConfig.classList.toggle('hidden', this.value !== 'secrets-manager');
        });

        // Cloudflare enabled handler
        document.getElementById('cloudflareEnabled').addEventListener('change', function() {
            document.getElementById('cloudflareFields').classList.toggle('hidden', !this.checked);
        });

        // Form submission
        document.getElementById('manifestForm').addEventListener('submit', async function(e) {
            e.preventDefault();

            const manifest = {
                version: "1.0",
                application: {
                    name: document.getElementById('appName').value,
                    description: document.getElementById('appDescription').value || undefined
                },
                environment: {
                    name: document.getElementById('envName').value
                },
                deployment: {
                    platform: document.getElementById('platform').value || "docker",
                    source: {
                        type: document.getElementById('sourceType').value,
                        path: document.getElementById('sourcePath').value
                    }
                },
                providers: [],
                credentials: {
                    source: document.getElementById('credentialsSource').value,
                    secrets: {}
                }
            };

            // Add AWS provider
            if (document.getElementById('provider-aws').checked) {
                const awsProvider = {
                    name: "aws",
                    region: document.getElementById('awsRegion').value
                };

                const instanceType = document.getElementById('instanceType').value;
                const environmentType = document.getElementById('environmentType').value;
                if (instanceType || environmentType) {
                    awsProvider.instance = {};
                    if (instanceType) awsProvider.instance.type = instanceType;
                    if (environmentType) awsProvider.instance.environment_type = environmentType;
                }

                const healthCheckPath = document.getElementById('healthCheckPath').value;
                if (healthCheckPath) {
                    awsProvider.health_check = { path: healthCheckPath };
                }

                manifest.providers.push(awsProvider);

                // Add AWS secret ARN if using secrets manager
                if (manifest.credentials.source === 'secrets-manager') {
                    const awsSecretArn = document.getElementById('awsSecretArn').value;
                    if (awsSecretArn) manifest.credentials.secrets.aws = awsSecretArn;
                }
            }

            // Add GCP provider
            if (document.getElementById('provider-gcp').checked) {
                const gcpProvider = {
                    name: "gcp",
                    region: document.getElementById('gcpRegion').value,
                    project_id: document.getElementById('projectId').value
                };

                const cpu = document.getElementById('cpu').value;
                const memory = document.getElementById('memory').value;
                if (cpu || memory) {
                    gcpProvider.cloud_run = {};
                    if (cpu) gcpProvider.cloud_run.cpu = cpu;
                    if (memory) gcpProvider.cloud_run.memory = memory;
                }

                manifest.providers.push(gcpProvider);

                // Add GCP secret ARN
                if (manifest.credentials.source === 'secrets-manager') {
                    const gcpSecretArn = document.getElementById('gcpSecretArn').value;
                    if (gcpSecretArn) manifest.credentials.secrets.gcp = gcpSecretArn;
                }
            }

            // Add Azure provider
            if (document.getElementById('provider-azure').checked) {
                const azureProvider = {
                    name: "azure",
                    region: document.getElementById('azureRegion').value,
                    resource_group: document.getElementById('resourceGroup').value
                };

                const azureCpu = document.getElementById('azureCpu').value;
                const azureMemory = document.getElementById('azureMemory').value;
                if (azureCpu || azureMemory) {
                    azureProvider.container = {};
                    if (azureCpu) azureProvider.container.cpu = parseFloat(azureCpu);
                    if (azureMemory) azureProvider.container.memory = parseFloat(azureMemory);
                }

                manifest.providers.push(azureProvider);

                // Add Azure secret ARN
                if (manifest.credentials.source === 'secrets-manager') {
                    const azureSecretArn = document.getElementById('azureSecretArn').value;
                    if (azureSecretArn) manifest.credentials.secrets.azure = azureSecretArn;
                }
            }

            // Add Cloudflare configuration
            if (document.getElementById('cloudflareEnabled')?.checked) {
                manifest.cloudflare = {
                    enabled: true,
                    zone_id: document.getElementById('cloudflareZoneId').value,
                    domain: document.getElementById('cloudflareDomain').value,
                    load_balancer: {
                        name: document.getElementById('lbName').value,
                        steering_policy: document.getElementById('steeringPolicy').value,
                        proxied: document.getElementById('proxied').checked
                    },
                    monitors: [{
                        name: "default-health",
                        type: document.getElementById('monitorType').value,
                        path: document.getElementById('monitorPath').value || "/health",
                        interval: parseInt(document.getElementById('monitorInterval').value),
                        retries: parseInt(document.getElementById('monitorRetries').value),
                        expected_codes: "200"
                    }],
                    pools: manifest.providers.map(provider => ({
                        name: `${provider.name}-${provider.region}`,
                        description: `${provider.name.toUpperCase()} pool in ${provider.region}`,
                        provider: provider.name,
                        origins: [{
                            name: `${provider.name}-origin`,
                            enabled: true,
                            weight: 1.0
                        }]
                    }))
                };

                // Add Cloudflare secret ARN
                if (manifest.credentials.source === 'secrets-manager') {
                    const cloudflareSecretArn = document.getElementById('cloudflareSecretArn').value;
                    if (cloudflareSecretArn) manifest.credentials.secrets.cloudflare = cloudflareSecretArn;
                }
            }

            // Send to server
            try {
                const response = await fetch('/api/generate', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(manifest)
                });

                if (response.ok) {
                    const data = await response.json();
                    showMessage(`Success! Manifest saved to: ${data.path}`, 'success');
                } else {
                    const error = await response.text();
                    showMessage(`Error: ${error}`, 'error');
                }
            } catch (error) {
                showMessage(`Error: ${error.message}`, 'error');
            }
        });

        function showMessage(message, type) {
            const messageArea = document.getElementById('messageArea');
            messageArea.innerHTML = `<div class="message ${type}">${message}</div>`;
            messageArea.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        // Initialize
        document.getElementById('credentialsSource').value = 'secrets-manager';
        document.getElementById('credentialsSource').dispatchEvent(new Event('change'));
    </script>
</body>
</html>
