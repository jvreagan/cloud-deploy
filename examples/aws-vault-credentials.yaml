version: "1.0"

# Docker image to deploy
image: "my-app:latest"

# HashiCorp Vault configuration
vault:
  address: "http://127.0.0.1:8200"
  auth:
    method: token
    token: "${VAULT_TOKEN}"

# AWS Provider - credentials loaded from Vault!
provider:
  name: aws
  region: us-east-2

  # Tell cloud-deploy to load AWS credentials from Vault
  credentials:
    source: vault  # Options: vault, environment, manifest, cli

# Application secrets from Vault (separate from cloud credentials)
secrets:
  - name: DATABASE_URL
    vault_path: secret/data/myapp/database
    vault_key: url

  - name: API_KEY
    vault_path: secret/data/myapp/stripe
    vault_key: api_key

# Regular environment variables
environment_variables:
  ENV: production
  LOG_LEVEL: info

application:
  name: vault-creds-demo
  description: "Demo using Vault for both cloud and application credentials"

environment:
  name: vault-creds-env
  cname: vault-demo

deployment:
  platform: docker
  solution_stack: "64bit Amazon Linux 2023 v4.7.2 running Docker"
  source:
    type: local
    path: "."

instance:
  type: t3.micro
  environment_type: SingleInstance

health_check:
  type: enhanced
  path: /health
